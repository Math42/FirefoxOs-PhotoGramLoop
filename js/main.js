// Generated by CoffeeScript 1.6.3
var App,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

App = (function() {
  App.capturedImage;

  App.layerImage;

  App.canvas;

  App.imageWidth;

  App.imageHeight;

  function App() {
    this.onLoad = __bind(this.onLoad, this);
    this.canvas = $("canvas");
    this.imageWidth = this.canvas.width();
    this.imageHeight = this.canvas.height();
  }

  App.prototype.init = function() {
    this.bind();
    return this.screenList();
  };

  App.prototype.bind = function() {
    var _this = this;
    $('body').on('click', '#home', function() {
      return _this.screenList();
    });
    $('body').on('click', '#addPic', function() {
      return _this.screenPicture();
    });
    return $('body').on('click', '#help', function() {
      return _this.screenHelp();
    });
  };

  App.prototype.screenList = function() {
    return this.displayScreen('#screen-list');
  };

  App.prototype.screenPicture = function() {
    this.displayScreen('#screen-picture');
    return this.gramify();
  };

  App.prototype.screenHelp = function() {
    return this.displayScreen('#screen-help');
  };

  App.prototype.displayScreen = function(selector) {
    $('.screen').hide();
    return $(selector).show();
  };

  App.prototype.gramify = function(onSuccess) {
    this.ctx = this.canvas.get(0).getContext("2d");
    this.capturedImage = this.loadImage('images/demo.jpg', this.onLoad);
    this.layerImage1 = this.loadImage('images/layerfox-1.png', this.onLoad);
    this.layerImage2 = this.loadImage('images/layerfox-2.png', this.onLoad);
    this.layerColor = this.loadImage('images/layerfox-blue.png', this.onLoad);
    return this.imagesLoaded = 0;
  };

  App.prototype.onLoad = function() {
    this.imagesLoaded += 1;
    if (this.imagesLoaded === 3) {
      this.ctx.drawImage(this.capturedImage, 0, 0, this.imageWidth, this.imageHeight);
      this.ctx.globalAlpha = 0.7;
      this.ctx.drawImage(this.layerColor, 0, 0, this.imageWidth, this.imageHeight);
      this.ctx.globalAlpha = 0.7;
      this.ctx.drawImage(this.layerImage1, 0, 0, this.imageWidth, this.imageHeight);
      this.ctx.globalAlpha = 1;
      return this.ctx.drawImage(this.layerImage2, 0, 0, this.imageWidth, this.imageHeight);
    }
  };

  App.prototype.loadImage = function(src, onload) {
    var img;
    img = new Image();
    img.onload = onload;
    img.src = src;
    return img;
  };

  return App;

})();

$(function() {
  var app;
  app = new App();
  return app.init();
});
